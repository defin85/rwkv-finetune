## ADDED Requirements

### Requirement: Lifecycle версий датасета
Система MUST поддерживать формальный lifecycle версий датасета для дообучения RWKV v7 с этапами ingest, normalise, validate, split и release.

#### Scenario: Выпуск версии датасета
- **WHEN** команда готовит новый релиз датасета
- **THEN** формируется versioned-набор данных и фиксируется результат каждого этапа lifecycle

#### Scenario: Воспроизводимость релиза
- **WHEN** команда повторно запускает пайплайн на том же входном наборе и конфигурации
- **THEN** система MUST выдавать воспроизводимый состав релиза и эквивалентный `manifest`

### Requirement: Двухконтурная модель источников и provenance
Система MUST разделять источники на контуры `core` и `extended` и вести provenance для каждого образца в `manifest`.

#### Scenario: Добавление образца из mixed-use источника
- **WHEN** в датасет добавляется образец из mixed-use источника
- **THEN** образец MUST маркироваться как `extended` и содержать поля происхождения и лицензии

#### Scenario: Аудит происхождения
- **WHEN** требуется аудит конкретного образца
- **THEN** система MUST предоставлять трассировку до исходного источника и версии происхождения

### Requirement: Языковая политика промптов
Система MUST принимать в обучающий датасет только те образцы, где пользовательский промпт сформулирован на русском языке.

#### Scenario: Проверка языка перед релизом
- **WHEN** образец проходит стадию валидации
- **THEN** образец с нерусским пользовательским промптом MUST быть исключён из train/eval наборов

### Requirement: Покрытие типов задач
Система MUST поддерживать таксономию задач минимум из категорий: генерация кода, рефакторинг, запросы 1C, объяснение/ревью.

#### Scenario: Формирование релиза с балансом задач
- **WHEN** формируется релиз датасета
- **THEN** каждая обязательная категория MUST присутствовать в составе релиза и быть отражена в `manifest`

### Requirement: Базовый баланс категорий для первых релизов
Система MUST обеспечивать базовый баланс категорий задач для первых релизов датасета: генерация 35%, рефакторинг 35%, запросы 1C 15%, объяснение/ревью 15%, с допустимым отклонением не более 5 процентных пунктов по каждой категории.

#### Scenario: Проверка баланса категорий перед релизом
- **WHEN** система выполняет pre-release валидацию датасета
- **THEN** релиз MUST блокироваться, если любая категория выходит за пределы допустимого отклонения

#### Scenario: Паритет генерации и рефакторинга
- **WHEN** рассчитывается фактическое распределение категорий
- **THEN** доли генерации и рефакторинга MUST оставаться паритетными в пределах допустимого отклонения

### Requirement: Quality gates перед выпуском
Система MUST применять quality gates до выпуска версии: exact/near dedup, синтаксическая проверка BSL, фильтрация секретов/PII и контроль leakage.

#### Scenario: Обнаружен критический дефект качества
- **WHEN** любой из quality gates возвращает критическое нарушение
- **THEN** выпуск версии MUST быть заблокирован до устранения нарушения

#### Scenario: Проверка leakage между train и eval
- **WHEN** система выполняет контроль пересечений train/eval
- **THEN** образцы, нарушающие правила split и near-dedup, MUST исключаться или перераспределяться до публикации релиза

### Requirement: Стратегия оценки и итеративного улучшения
Система MUST поддерживать отдельные eval-наборы для генерации и рефакторинга и использовать результаты оценки для следующей итерации curating.

#### Scenario: Завершение обучающего прогона
- **WHEN** завершён train/eval цикл на очередной версии датасета
- **THEN** результаты MUST быть сохранены по категориям задач и использоваться для формирования backlog hard-cases следующей версии
