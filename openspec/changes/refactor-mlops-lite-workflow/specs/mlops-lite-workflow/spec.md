## ADDED Requirements

### Requirement: Stage-oriented MLOps-lite pipeline
Система MUST поддерживать унифицированный pipeline со стадиями `prepare`, `train`, `evaluate`, `release`, где каждая стадия имеет явный вход, выход и статус выполнения.

#### Scenario: Успешный сквозной запуск
- **WHEN** команда запускает новый training run с валидными входными артефактами
- **THEN** стадии выполняются в фиксированном порядке, а run получает финальный статус `released` или `completed-without-release`

#### Scenario: Ошибка на промежуточной стадии
- **WHEN** любая стадия завершается ошибкой валидации или runtime
- **THEN** pipeline MUST прерываться с финальным статусом `failed`, а ошибка MUST фиксироваться в run-артефактах

### Requirement: Reproducible run manifest
Система MUST формировать immutable run manifest для каждого run, включающий как минимум snapshot конфигураций, runtime-параметры, версию датасета, git revision и ссылки на артефакты run.

#### Scenario: Аудит воспроизводимости запуска
- **WHEN** инженер сравнивает два запуска с одинаковыми входными версиями данных и конфигураций
- **THEN** система MUST позволять подтвердить эквивалентность ключевых manifest-полей и выявить любые расхождения

### Requirement: Сквозной lineage датасета и адаптера
Система MUST поддерживать трассировку от dataset release до adapter release через стабильные идентификаторы и ссылки между manifest-артефактами.

#### Scenario: Аудит релиза адаптера
- **WHEN** требуется определить происхождение выпущенного адаптера
- **THEN** система MUST возвращать связанный `run_id`, `dataset_version` и ссылки на соответствующие manifest-артефакты

### Requirement: Gate-контроль перед release
Система MUST блокировать выпуск адаптера, если не пройдены обязательные gate-проверки: статус quality gates датасета, `domain eval` и `retention eval`.

#### Scenario: Провал retention eval
- **WHEN** retention eval показывает регрессию хуже заданного порога относительно baseline
- **THEN** release MUST быть заблокирован, а причина блокировки MUST быть сохранена в manifest

#### Scenario: Датасет не прошёл quality gates
- **WHEN** dataset release имеет критический статус по capability `dataset-development`
- **THEN** обучение и/или выпуск адаптера MUST быть заблокированы до устранения нарушений

### Requirement: Ограничение на оркестрацию в MLOps-lite
Система MUST оставаться работоспособной в локальном WSL-режиме без обязательной зависимости от внешних orchestration платформ или внешнего metadata server.

#### Scenario: Локальный запуск без внешних сервисов
- **WHEN** pipeline запускается в изолированной локальной среде проекта
- **THEN** все критические операции (`prepare/train/evaluate/release`) MUST выполняться через локальные скрипты и файловые артефакты

### Requirement: Resume и rollback policy
Система MUST поддерживать возобновление pipeline с последней успешно завершённой стадии и MUST поддерживать rollback к предыдущему стабильному adapter release при зафиксированной регрессии.

#### Scenario: Возобновление после исправления ошибки
- **WHEN** run завершился со статусом `failed`, ошибка устранена и входные версии не изменены
- **THEN** инженер MUST иметь возможность возобновить pipeline без повторения уже успешных стадий

#### Scenario: Откат после регрессии качества
- **WHEN** после выпуска адаптера обнаружена подтверждённая регрессия качества
- **THEN** система MUST поддерживать операционный откат к предыдущему стабильному release с сохранением audit trail
